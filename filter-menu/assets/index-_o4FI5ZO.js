function y(e){return e.charAt(0).toLowerCase()+e.slice(1)}function p(e,t,n){if(!e.shiftKey){const i=e.key;switch(i){case"Enter":case"Escape":case"PageUp":case"PageDown":case"End":case"Home":case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":t.dispatchEvent(new CustomEvent(y(`${i}Key${n}`),{detail:e,bubbles:!0}));break;case" ":t.dispatchEvent(new CustomEvent(`spacebarKey${n}`,{detail:e,bubbles:!0}));break;default:return}}}function b(e){p(e,this,"Down")}function D(e){e.addEventListener("keydown",b)}function k(e){e.removeEventListener("keydown",b)}const h={},C="nid",M=N(3);function E(e){return Math.floor(Math.random()*e)}function N(e){const t="abcdefghijklmnopqrstuvwxyz",i=t+"0123456789";let s=t[E(25)];for(let o=1;o<e;o++)s+=i[E(35)];return s}function F(e,t=C){const i=`${t}${t===""?"":"-"}${M}`;return h[i]=h[i]||0,e.id||e.setAttribute("id",`${i}-${h[i]++}`),e.id}const c={};function x(e,t,n){e.dispatchEvent(new CustomEvent("focusExit",{detail:{fromElement:t,toElement:n},bubbles:!1}))}function K(e){const t=e.target;this.el.contains(t)===!0?this.currentFocusElement=t:(window.removeEventListener("blur",this.onWindowBlurListener),document.removeEventListener("focusin",this.onDocumentFocusInListener),x(this.el,this.currentFocusElement,t),this.currentFocusElement=null)}function $(){x(this.el,this.currentFocusElement,void 0)}function A(){document.addEventListener("focusin",this.onDocumentFocusInListener),window.addEventListener("blur",this.onWindowBlurListener)}class R{constructor(t){this.el=t,this.currentFocusElement=null,this.onWidgetFocusInListener=A.bind(this),this.onDocumentFocusInListener=K.bind(this),this.onWindowBlurListener=$.bind(this),this.el.addEventListener("focusin",this.onWidgetFocusInListener)}removeEventListeners(){window.removeEventListener("blur",this.onWindowBlurListener),document.removeEventListener("focusin",this.onDocumentFocusInListener),this.el.removeEventListener("focusin",this.onWidgetFocusInListener)}}function B(e){let t=null;return F(e),c[e.id]||(t=new R(e),c[e.id]=t),t}function P(e){const t=c[e.id];t&&(t.removeEventListeners(),delete c[e.id])}const S={axis:"both",autoInit:"interactive",autoReset:"current",ignoreByDelegateSelector:null,wrap:!1};function a(e){return!e.hidden&&e.getAttribute("aria-disabled")!=="true"}function w(e,t){return t>=0&&t<e.length?a(e[t]):!1}function O(e){return e.filter(a)}function r(e){return e.findIndex(t=>a(t))}function v(e){return e.indexOf(O(e).reverse()[0])}function I(e,t,n){return e.findIndex(i=>a(i)&&i.getAttribute(t)===n)}function W(e){return I(e,"aria-checked","true")}function _(e){return I(e,"aria-selected","true")}function d(e,t){return t.ignoreByDelegateSelector!==null?[...e.querySelectorAll(t.ignoreByDelegateSelector)]:[]}function q(e,t,n){let i=-1;if(t===null||U(e,t))n===!0&&(i=v(e));else{let s=t;for(;--s>=0;)if(a(e[s])){i=s;break}}return i}function H(e,t,n){let i=-1;if(t===null)i=r(e);else if(j(e,t))n===!0&&(i=r(e));else{let s=t;for(;++s<e.length;)if(a(e[s])){i=s;break}}return i}function g(e,t,n){let i=-1;switch(e){case"none":i=null;break;case"current":i=n;break;case"interactive":i=r(t);break;case"ariaChecked":i=W(t);break;case"ariaSelected":i=_(t);break;case"ariaSelectedOrInteractive":i=_(t),i=i===-1?r(t):i;break;default:i=typeof e=="number"||e===null?e:-1}return i}function U(e,t){return t===r(e)}function j(e,t){return t===v(e)}function z(e){const t=d(this._el,this.options);(t.length===0||!t.includes(e.detail.target))&&(this.index=q(this.items,this.index,this.options.wrap))}function V(e){const t=d(this._el,this.options);(t.length===0||!t.includes(e.detail.target))&&(this.index=H(this.items,this.index,this.options.wrap))}function G(e){const t=this.indexOf(e.target.closest(this._itemSelector));w(this.items,t)&&(this.index=t)}function J(e){const t=d(this._el,this.options);(t.length===0||!t.includes(e.detail.target))&&(this.index=r(this.items))}function Q(e){const t=d(this._el,this.options);(t.length===0||!t.includes(e.detail.target))&&(this.index=v(this.items))}function T(){this.options.autoReset!==null&&this.reset()}function X(e){const t=this.index;let n=this.index;const{addedNodes:i,attributeName:s,removedNodes:o,target:l,type:m}=e[0];m==="attributes"?l===this.currentItem?s==="aria-disabled"?n=this.index:s==="hidden"&&(n=r(this.items)):n=this.index:m==="childList"&&(o.length>0&&[...o].includes(this._cachedElement)?n=r(this.items):(o.length>0||i.length>0)&&(n=this.indexOf(this._cachedElement))),this._index=n,this._el.dispatchEvent(new CustomEvent("navigationModelMutation",{bubbles:!1,detail:{fromIndex:t,toIndex:n}}))}class Y{constructor(t,n,i){this.options=Object.assign({},S,i),this._el=t,this._itemSelector=n}}class Z extends Y{constructor(t,n,i){super(t,n,i);const s=this._index,o=g(this.options.autoInit,this.items,this.index);this._index=o,this._cachedElement=this.items[o],this._el.dispatchEvent(new CustomEvent("navigationModelInit",{bubbles:!1,detail:{firstInteractiveIndex:this.firstNavigableIndex,fromIndex:s,items:this.items,toIndex:o}}))}get currentItem(){return this.items[this.index]}get items(){return[...this._el.querySelectorAll(`${this._itemSelector}`)]}get index(){return this._index}set index(t){if(t!==this.index&&w(this.items,t)){const n=this.index;this._cachedElement=this.items[t],this._index=t,this._el.dispatchEvent(new CustomEvent("navigationModelChange",{bubbles:!1,detail:{fromIndex:n,toIndex:t}}))}}indexOf(t){return this.items.indexOf(t)}reset(){const t=this.index,n=g(this.options.autoReset,this.items,this.index);n!==t&&(this._index=n,this._el.dispatchEvent(new CustomEvent("navigationModelReset",{bubbles:!1,detail:{fromIndex:t,toIndex:n}})))}}class ee{constructor(t,n){this.model=n,this.el=t,this._keyPrevListener=z.bind(n),this._keyNextListener=V.bind(n),this._keyHomeListener=J.bind(n),this._keyEndListener=Q.bind(n),this._clickListener=G.bind(n),this._focusExitListener=T.bind(n),this._observer=new MutationObserver(X.bind(n)),D(this.el),B(this.el);const i=n.options.axis;(i==="both"||i==="x")&&(this.el.addEventListener("arrowLeftKeyDown",this._keyPrevListener),this.el.addEventListener("arrowRightKeyDown",this._keyNextListener)),(i==="both"||i==="y")&&(this.el.addEventListener("arrowUpKeyDown",this._keyPrevListener),this.el.addEventListener("arrowDownKeyDown",this._keyNextListener)),this.el.addEventListener("homeKeyDown",this._keyHomeListener),this.el.addEventListener("endKeyDown",this._keyEndListener),this.el.addEventListener("click",this._clickListener),this.el.addEventListener("focusExit",this._focusExitListener),this._observer.observe(this.el,{childList:!0,subtree:!0,attributeFilter:["aria-disabled","hidden"],attributes:!0,attributeOldValue:!0})}destroy(){k(this.el),P(this.el),this.el.removeEventListener("arrowLeftKeyDown",this._keyPrevListener),this.el.removeEventListener("arrowRightKeyDown",this._keyNextListener),this.el.removeEventListener("arrowUpKeyDown",this._keyPrevListener),this.el.removeEventListener("arrowDownKeyDown",this._keyNextListener),this.el.removeEventListener("homeKeyDown",this._keyHomeListener),this.el.removeEventListener("endKeyDown",this._keyEndListener),this.el.removeEventListener("click",this._clickListener),this.el.removeEventListener("focusExit",this._focusExitListener),this._observer.disconnect()}}function te(e,t,n){const i=new Z(e,t,n);return new ee(e,i)}const u={},ie="nid",ne=se(3);function L(e){return Math.floor(Math.random()*e)}function se(e){const t="abcdefghijklmnopqrstuvwxyz",i=t+"0123456789";let s=t[L(25)];for(let o=1;o<e;o++)s+=i[L(35)];return s}function f(e,t=ie){const i=`${t}${t===""?"":"-"}${ne}`;return u[i]=u[i]||0,e.id||e.setAttribute("id",`${i}-${u[i]++}`),e.id}const oe={activeDescendantClassName:"active-descendant",autoInit:"none",autoReset:"none",autoScroll:!1,axis:"both",wrap:!1};function re(e){const{items:t,toIndex:n}=e.detail,i=t[n];i&&(i.classList.add(this._options.activeDescendantClassName),this._focusEl.setAttribute("aria-activedescendant",i.id)),this._el.dispatchEvent(new CustomEvent("activeDescendantInit",{detail:e.detail}))}function ae(e){const{fromIndex:t,toIndex:n}=e.detail,i=this.items[t],s=this.items[n];i&&i.classList.remove(this._options.activeDescendantClassName),s&&(s.classList.add(this._options.activeDescendantClassName),this._focusEl.setAttribute("aria-activedescendant",s.id),this._options.autoScroll&&this._itemContainerEl&&s.scrollIntoView({block:"center"})),this._el.dispatchEvent(new CustomEvent("activeDescendantChange",{detail:e.detail}))}function ce(e){const t=e.detail.toIndex,n=this._options.activeDescendantClassName;if(this.items.forEach(function(i){i.classList.remove(n)}),t!==null&&t!==-1){const i=this.items[t];i.classList.add(n),this._focusEl.setAttribute("aria-activedescendant",i.id)}else this._focusEl.removeAttribute("aria-activedescendant");this._el.dispatchEvent(new CustomEvent("activeDescendantReset",{detail:e.detail}))}function de(e){const{toIndex:t}=e.detail,n=this._options.activeDescendantClassName;this.items.forEach(function(i,s){f(i),s!==t?i.classList.remove(n):i.classList.add(n)}),this._el.dispatchEvent(new CustomEvent("activeDescendantMutation",{detail:e.detail}))}class le{constructor(t){this._el=t,this._onMutationListener=de.bind(this),this._onChangeListener=ae.bind(this),this._onResetListener=ce.bind(this),this._onInitListener=re.bind(this),this._el.addEventListener("navigationModelMutation",this._onMutationListener),this._el.addEventListener("navigationModelChange",this._onChangeListener),this._el.addEventListener("navigationModelReset",this._onResetListener),this._el.addEventListener("navigationModelInit",this._onInitListener)}destroy(){this._el.removeEventListener("navigationModelMutation",this._onMutationListener),this._el.removeEventListener("navigationModelChange",this._onChangeListener),this._el.removeEventListener("navigationModelReset",this._onResetListener),this._el.removeEventListener("navigationModelInit",this._onInitListener)}}class he extends le{constructor(t,n,i,s,o){super(t),this._options=Object.assign({},oe,o),this._focusEl=n,this._itemContainerEl=i,this._itemSelector=s,f(this._itemContainerEl),this._itemContainerEl!==this._focusEl&&n.setAttribute("aria-owns",this._itemContainerEl.id),this._navigationEmitter=te(t,s,{autoInit:this._options.autoInit,autoReset:this._options.autoReset,axis:this._options.axis,ignoreByDelegateSelector:this._options.ignoreByDelegateSelector,wrap:this._options.wrap}),this.items.forEach(function(l){f(l)})}get index(){return this._navigationEmitter.model.index}set index(t){this._navigationEmitter.model.index=t}reset(){this._navigationEmitter.model.reset()}get currentItem(){return this._navigationEmitter.model.currentItem}get items(){return this._navigationEmitter.model.items}set wrap(t){this._navigationEmitter.model.options.wrap=t}destroy(){super.destroy(),this._navigationEmitter.destroy()}}function ue(e,t,n,i,s){return new he(e,t,n,i,s)}export{ue as c};
